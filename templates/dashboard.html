{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard — Starter Kit{% endblock %}
{% block topbar_title %}Dashboard{% endblock %}

{% block extra_css %}
<style>
  /* ── Dashboard-specific styles ── */
  .dash-grid-4 {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 18px;
    margin-bottom: 24px;
  }
  .dash-grid-main {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 18px;
    margin-bottom: 24px;
  }
  .dash-grid-bottom {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 18px;
    margin-bottom: 24px;
  }

  /* Stat card */
  .dash-stat {
    background: var(--sk-surface);
    border: 1px solid var(--sk-border);
    border-radius: var(--sk-radius);
    padding: 20px;
    box-shadow: var(--sk-shadow-sm);
    display: flex;
    flex-direction: column;
    gap: 12px;
    transition: box-shadow var(--sk-transition), transform var(--sk-transition);
    position: relative;
    overflow: hidden;
  }
  .dash-stat:hover { box-shadow: var(--sk-shadow); transform: translateY(-1px); }
  .dash-stat-top { display: flex; align-items: flex-start; justify-content: space-between; }
  .dash-stat-icon {
    width: 42px; height: 42px;
    border-radius: var(--sk-radius-sm);
    display: flex; align-items: center; justify-content: center;
    font-size: 1.1rem; flex-shrink: 0;
  }
  .dash-stat-value {
    font-size: 1.75rem;
    font-weight: 700;
    letter-spacing: -0.035em;
    line-height: 1;
    color: var(--sk-text);
    margin-top: 4px;
  }
  .dash-stat-label {
    font-size: 0.78rem;
    color: var(--sk-muted);
    font-weight: 500;
    margin-top: 2px;
  }
  .dash-stat-footer {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.78rem;
    font-weight: 600;
    padding-top: 10px;
    border-top: 1px solid var(--sk-border);
  }
  .dash-delta-up   { color: #16a34a; }
  .dash-delta-down { color: #e11d48; }
  .dash-delta-note { color: var(--sk-muted); font-weight: 400; }

  /* Sparkline canvas inside stat card */
  .dash-sparkline { height: 40px; }
  .dash-sparkline-wrapper { 
    position: relative;
    height: 40px;
    width: 100%;
}

  /* Chart card */
  .dash-chart-card {
    background: var(--sk-surface);
    border: 1px solid var(--sk-border);
    border-radius: var(--sk-radius);
    box-shadow: var(--sk-shadow-sm);
    padding: 22px;
    display: flex;
    flex-direction: column;
  }
  .dash-chart-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    margin-bottom: 20px;
  }
  .dash-chart-title {
    font-size: 0.9rem;
    font-weight: 700;
    color: var(--sk-text);
    margin: 0;
  }
  .dash-chart-sub {
    font-size: 0.75rem;
    color: var(--sk-muted);
    margin: 2px 0 0;
  }
  .dash-chart-legend {
    display: flex;
    align-items: center;
    gap: 14px;
  }
  .dash-legend-item {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 0.75rem;
    color: var(--sk-muted);
    font-weight: 500;
  }
  .dash-legend-dot {
    width: 8px; height: 8px; border-radius: 50%;
  }
  .dash-chart-body { flex: 1; position: relative; }
  .dash-chart-body canvas { max-height: 100%; }

  /* Period tabs */
  .dash-period-tabs {
    display: flex;
    gap: 2px;
    background: var(--sk-bg);
    border: 1px solid var(--sk-border);
    border-radius: var(--sk-radius-sm);
    padding: 3px;
  }
  .dash-period-tab {
    padding: 4px 12px;
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--sk-muted);
    border-radius: 4px;
    cursor: pointer;
    border: none;
    background: none;
    transition: all var(--sk-transition);
  }
  .dash-period-tab.active {
    background: var(--sk-surface);
    color: var(--sk-primary);
    box-shadow: var(--sk-shadow-sm);
  }

  /* Activity table */
  .dash-activity-list { display: flex; flex-direction: column; }
  .dash-activity-item {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 11px 0;
    border-bottom: 1px solid var(--sk-border);
  }
  .dash-activity-item:last-child { border-bottom: none; padding-bottom: 0; }
  .dash-activity-avatar {
    width: 34px; height: 34px;
    border-radius: 50%;
    background: var(--sk-primary);
    color: #fff;
    display: flex; align-items: center; justify-content: center;
    font-size: 0.72rem;
    font-weight: 700;
    flex-shrink: 0;
  }
  .dash-activity-text { flex: 1; min-width: 0; }
  .dash-activity-name { font-size: 0.85rem; font-weight: 600; color: var(--sk-text); }
  .dash-activity-desc { font-size: 0.78rem; color: var(--sk-muted); margin-top: 1px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .dash-activity-time { font-size: 0.73rem; color: var(--sk-muted); flex-shrink: 0; }

  /* Top pages table */
  .dash-pages-row {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 0;
    border-bottom: 1px solid var(--sk-border);
  }
  .dash-pages-row:last-child { border-bottom: none; }
  .dash-pages-rank {
    width: 20px;
    font-size: 0.75rem;
    font-weight: 700;
    color: var(--sk-muted);
    flex-shrink: 0;
    text-align: center;
  }
  .dash-pages-info { flex: 1; min-width: 0; }
  .dash-pages-url { font-size: 0.82rem; font-weight: 600; color: var(--sk-text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .dash-pages-meta { font-size: 0.73rem; color: var(--sk-muted); }
  .dash-pages-bar-wrap { width: 80px; flex-shrink: 0; }
  .dash-pages-bar-bg { height: 5px; background: var(--sk-border); border-radius: 3px; overflow: hidden; }
  .dash-pages-bar-fill { height: 100%; background: var(--sk-primary); border-radius: 3px; opacity: 0.6; }
  .dash-pages-count { font-size: 0.8rem; font-weight: 700; color: var(--sk-text); flex-shrink: 0; width: 40px; text-align: right; }

  /* Responsive */
  @media (max-width: 1199px) {
    .dash-grid-4    { grid-template-columns: repeat(2, 1fr); }
    .dash-grid-bottom { grid-template-columns: 1fr; }
  }
  @media (max-width: 767px) {
    .dash-grid-4    { grid-template-columns: 1fr 1fr; }
    .dash-grid-main { grid-template-columns: 1fr; }
    .dash-grid-bottom { grid-template-columns: 1fr; }
  }
  @media (max-width: 480px) {
    .dash-grid-4 { grid-template-columns: 1fr; }
  }
</style>
{% endblock %}


{% block content %}

{# ── Page Header ─────────────────────────────────────────── #}
<div class="sk-page-header d-flex align-items-start justify-content-between flex-wrap gap-3">
  <div>
    <nav class="sk-breadcrumb mb-1">
      <span>Home</span><span class="sep">/</span><span>Dashboard</span>
    </nav>
    <h1 class="sk-page-title">Dashboard</h1>
    <p class="sk-page-subtitle">Welcome back, {{ user.first_name|default:user.username }} — here's what's happening.</p>
  </div>
  <div class="d-flex gap-2 align-items-center">
    <button class="btn btn-sm btn-outline-secondary d-flex align-items-center gap-2" style="font-size:.8rem;">
      <i class="bi bi-calendar3"></i> Last 30 days
    </button>
    <button class="btn btn-sm btn-primary d-flex align-items-center gap-2" style="font-size:.8rem;">
      <i class="bi bi-download"></i> Export
    </button>
  </div>
</div>


{# ── Stat Cards ──────────────────────────────────────────── #}
<div class="dash-grid-4">

  {# Total Revenue #}
  <div class="dash-stat">
    <div class="dash-stat-top">
      <div>
        <div class="dash-stat-value">$48,295</div>
        <div class="dash-stat-label">Total Revenue</div>
      </div>
      <div class="dash-stat-icon" style="background:#dbeafe;color:#2563eb;">
        <i class="bi bi-currency-dollar"></i>
      </div>
    </div>
    <div class="dash-sparkline-wrapper">
      <canvas class="dash-sparkline" id="spark-revenue"></canvas>
    </div>
    <div class="dash-stat-footer">
      <i class="bi bi-arrow-up-right dash-delta-up"></i>
      <span class="dash-delta-up">12.4%</span>
      <span class="dash-delta-note">vs last month</span>
    </div>
  </div>

  {# New Users #}
  <div class="dash-stat">
    <div class="dash-stat-top">
      <div>
        <div class="dash-stat-value">2,841</div>
        <div class="dash-stat-label">New Users</div>
      </div>
      <div class="dash-stat-icon" style="background:#dcfce7;color:#16a34a;">
        <i class="bi bi-people"></i>
      </div>
    </div>
    <div class="dash-sparkline-wrapper">
      <canvas class="dash-sparkline" id="spark-users"></canvas>
    </div>
    <div class="dash-stat-footer">
      <i class="bi bi-arrow-up-right dash-delta-up"></i>
      <span class="dash-delta-up">8.1%</span>
      <span class="dash-delta-note">vs last month</span>
    </div>
  </div>

  {# Orders #}
  <div class="dash-stat">
    <div class="dash-stat-top">
      <div>
        <div class="dash-stat-value">1,094</div>
        <div class="dash-stat-label">Orders</div>
      </div>
      <div class="dash-stat-icon" style="background:#fef3c7;color:#d97706;">
        <i class="bi bi-bag-check"></i>
      </div>
    </div>
    <div class="dash-sparkline-wrapper">
      <canvas class="dash-sparkline" id="spark-orders"></canvas>
    </div>
    <div class="dash-stat-footer">
      <i class="bi bi-arrow-down-right dash-delta-down"></i>
      <span class="dash-delta-down">3.2%</span>
      <span class="dash-delta-note">vs last month</span>
    </div>
  </div>

  {# Conversion Rate #}
  <div class="dash-stat">
    <div class="dash-stat-top">
      <div>
        <div class="dash-stat-value">3.68%</div>
        <div class="dash-stat-label">Conversion Rate</div>
      </div>
      <div class="dash-stat-icon" style="background:#ede9fe;color:#7c3aed;">
        <i class="bi bi-graph-up-arrow"></i>
      </div>
    </div>
    <div class="dash-sparkline-wrapper">
      <canvas class="dash-sparkline" id="spark-conv"></canvas>
    </div>
    <div class="dash-stat-footer">
      <i class="bi bi-arrow-up-right dash-delta-up"></i>
      <span class="dash-delta-up">0.4%</span>
      <span class="dash-delta-note">vs last month</span>
    </div>
  </div>

</div>


{# ── Main Charts Row ─────────────────────────────────────── #}
<div class="dash-grid-main">

  {# Revenue Line Chart #}
  <div class="dash-chart-card">
    <div class="dash-chart-header">
      <div>
        <h2 class="dash-chart-title">Revenue Overview</h2>
        <p class="dash-chart-sub">Monthly revenue vs target for 2024</p>
      </div>
      <div class="dash-period-tabs">
        <button class="dash-period-tab active" onclick="setPeriod(this,'revenue','6m')">6M</button>
        <button class="dash-period-tab" onclick="setPeriod(this,'revenue','1y')">1Y</button>
        <button class="dash-period-tab" onclick="setPeriod(this,'revenue','all')">All</button>
      </div>
    </div>
    <div class="dash-chart-legend mb-3">
      <span class="dash-legend-item"><span class="dash-legend-dot" style="background:#2563eb;"></span>Revenue</span>
      <span class="dash-legend-item"><span class="dash-legend-dot" style="background:#bfdbfe;"></span>Target</span>
    </div>
    <div class="dash-chart-body" style="height:240px;">
      <canvas id="chart-revenue"></canvas>
    </div>
  </div>

  {# Orders Bar Chart #}
  <div class="dash-chart-card">
    <div class="dash-chart-header">
      <div>
        <h2 class="dash-chart-title">Orders by Month</h2>
        <p class="dash-chart-sub">Completed vs cancelled orders</p>
      </div>
      <div class="dash-chart-legend">
        <span class="dash-legend-item"><span class="dash-legend-dot" style="background:#2563eb;"></span>Completed</span>
        <span class="dash-legend-item"><span class="dash-legend-dot" style="background:#fca5a5;"></span>Cancelled</span>
      </div>
    </div>
    <div class="dash-chart-body" style="height:258px;">
      <canvas id="chart-orders"></canvas>
    </div>
  </div>

</div>


{# ── Bottom Row ──────────────────────────────────────────── #}
<div class="dash-grid-bottom">

  {# Recent Activity + Top Pages stacked on the left #}
  <div class="dash-chart-card">
    <div class="dash-chart-header">
      <div>
        <h2 class="dash-chart-title">Traffic by Channel</h2>
        <p class="dash-chart-sub">Visitor sources this month</p>
      </div>
      <div class="dash-chart-legend">
        <span class="dash-legend-item"><span class="dash-legend-dot" style="background:#2563eb;"></span>Organic</span>
        <span class="dash-legend-item"><span class="dash-legend-dot" style="background:#60a5fa;"></span>Direct</span>
        <span class="dash-legend-item"><span class="dash-legend-dot" style="background:#93c5fd;"></span>Referral</span>
      </div>
    </div>
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:24px; align-items:center;">
      <div style="height:220px; position:relative;">
        <canvas id="chart-traffic"></canvas>
      </div>
      <div>
        <div class="dash-pages-row">
          <div class="dash-pages-rank" style="color:#2563eb;">1</div>
          <div class="dash-pages-info">
            <div class="dash-pages-url">Organic Search</div>
            <div class="dash-pages-meta">Google, Bing</div>
          </div>
          <div class="dash-pages-bar-wrap"><div class="dash-pages-bar-bg"><div class="dash-pages-bar-fill" style="width:100%;background:#2563eb;"></div></div></div>
          <div class="dash-pages-count">44%</div>
        </div>
        <div class="dash-pages-row">
          <div class="dash-pages-rank">2</div>
          <div class="dash-pages-info">
            <div class="dash-pages-url">Direct</div>
            <div class="dash-pages-meta">Bookmarks, typed</div>
          </div>
          <div class="dash-pages-bar-wrap"><div class="dash-pages-bar-bg"><div class="dash-pages-bar-fill" style="width:55%;"></div></div></div>
          <div class="dash-pages-count">24%</div>
        </div>
        <div class="dash-pages-row">
          <div class="dash-pages-rank">3</div>
          <div class="dash-pages-info">
            <div class="dash-pages-url">Referral</div>
            <div class="dash-pages-meta">External links</div>
          </div>
          <div class="dash-pages-bar-wrap"><div class="dash-pages-bar-bg"><div class="dash-pages-bar-fill" style="width:36%;"></div></div></div>
          <div class="dash-pages-count">16%</div>
        </div>
        <div class="dash-pages-row">
          <div class="dash-pages-rank">4</div>
          <div class="dash-pages-info">
            <div class="dash-pages-url">Social</div>
            <div class="dash-pages-meta">Twitter, LinkedIn</div>
          </div>
          <div class="dash-pages-bar-wrap"><div class="dash-pages-bar-bg"><div class="dash-pages-bar-fill" style="width:23%;background:#a78bfa;"></div></div></div>
          <div class="dash-pages-count">10%</div>
        </div>
        <div class="dash-pages-row">
          <div class="dash-pages-rank">5</div>
          <div class="dash-pages-info">
            <div class="dash-pages-url">Email</div>
            <div class="dash-pages-meta">Campaigns</div>
          </div>
          <div class="dash-pages-bar-wrap"><div class="dash-pages-bar-bg"><div class="dash-pages-bar-fill" style="width:14%;background:#34d399;"></div></div></div>
          <div class="dash-pages-count">6%</div>
        </div>
      </div>
    </div>
  </div>

  {# Right panel: Activity feed + mini area chart #}
  <div style="display:flex; flex-direction:column; gap:18px;">

    {# Weekly Sessions mini chart #}
    <div class="dash-chart-card">
      <div class="dash-chart-header" style="margin-bottom:12px;">
        <div>
          <h2 class="dash-chart-title">Sessions This Week</h2>
          <p class="dash-chart-sub">Daily unique visitors</p>
        </div>
        <span class="sk-badge sk-badge-green" style="font-size:.72rem;">
          <i class="bi bi-arrow-up-right me-1"></i>Live
        </span>
      </div>
      <div class="dash-chart-body" style="height:110px;">
        <canvas id="chart-sessions"></canvas>
      </div>
    </div>

    {# Recent Activity #}
    <div class="dash-chart-card" style="flex:1;">
      <div class="dash-chart-header" style="margin-bottom:4px;">
        <h2 class="dash-chart-title">Recent Activity</h2>
        <a href="#" style="font-size:.78rem; color:var(--sk-primary); text-decoration:none; font-weight:600;">View all</a>
      </div>
      <div class="dash-activity-list">

        <div class="dash-activity-item">
          <div class="dash-activity-avatar" style="background:#2563eb;">JD</div>
          <div class="dash-activity-text">
            <div class="dash-activity-name">Jane Doe</div>
            <div class="dash-activity-desc">Placed a new order #1094</div>
          </div>
          <div class="dash-activity-time">2m ago</div>
        </div>

        <div class="dash-activity-item">
          <div class="dash-activity-avatar" style="background:#16a34a;">MK</div>
          <div class="dash-activity-text">
            <div class="dash-activity-name">Mark Kim</div>
            <div class="dash-activity-desc">Registered a new account</div>
          </div>
          <div class="dash-activity-time">14m ago</div>
        </div>

        <div class="dash-activity-item">
          <div class="dash-activity-avatar" style="background:#d97706;">SR</div>
          <div class="dash-activity-text">
            <div class="dash-activity-name">Sara R.</div>
            <div class="dash-activity-desc">Cancelled order #1089</div>
          </div>
          <div class="dash-activity-time">1h ago</div>
        </div>

        <div class="dash-activity-item">
          <div class="dash-activity-avatar" style="background:#7c3aed;">AL</div>
          <div class="dash-activity-text">
            <div class="dash-activity-name">Alex Lee</div>
            <div class="dash-activity-desc">Updated billing details</div>
          </div>
          <div class="dash-activity-time">3h ago</div>
        </div>

        <div class="dash-activity-item">
          <div class="dash-activity-avatar" style="background:#e11d48;">FN</div>
          <div class="dash-activity-text">
            <div class="dash-activity-name">Fatima N.</div>
            <div class="dash-activity-desc">Submitted a support ticket</div>
          </div>
          <div class="dash-activity-time">5h ago</div>
        </div>

      </div>
    </div>

  </div>

</div>


{# ── Top Pages Table ─────────────────────────────────────── #}
<div class="dash-chart-card mb-4">
  <div class="dash-chart-header">
    <div>
      <h2 class="dash-chart-title">Top Pages</h2>
      <p class="dash-chart-sub">Most visited pages this month</p>
    </div>
    <button class="btn btn-sm btn-outline-secondary" style="font-size:.78rem;">
      <i class="bi bi-arrow-right me-1"></i> Full report
    </button>
  </div>
  <div class="sk-table-wrap">
    <table class="table sk-table">
      <thead>
        <tr>
          <th>#</th>
          <th>Page</th>
          <th>Views</th>
          <th>Unique Visitors</th>
          <th>Avg. Time</th>
          <th>Bounce Rate</th>
          <th>Trend</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="text-muted" style="font-size:.8rem;">1</td>
          <td>
            <div style="font-weight:600; font-size:.85rem;">/dashboard</div>
            <div style="font-size:.75rem; color:var(--sk-muted);">Dashboard home</div>
          </td>
          <td><strong>12,480</strong></td>
          <td>8,204</td>
          <td>4m 32s</td>
          <td><span class="sk-badge sk-badge-green">28%</span></td>
          <td><canvas id="trend-1" width="80" height="30"></canvas></td>
        </tr>
        <tr>
          <td class="text-muted" style="font-size:.8rem;">2</td>
          <td>
            <div style="font-weight:600; font-size:.85rem;">/products</div>
            <div style="font-size:.75rem; color:var(--sk-muted);">Product listing</div>
          </td>
          <td><strong>9,317</strong></td>
          <td>6,841</td>
          <td>3m 14s</td>
          <td><span class="sk-badge sk-badge-amber">42%</span></td>
          <td><canvas id="trend-2" width="80" height="30"></canvas></td>
        </tr>
        <tr>
          <td class="text-muted" style="font-size:.8rem;">3</td>
          <td>
            <div style="font-weight:600; font-size:.85rem;">/pricing</div>
            <div style="font-size:.75rem; color:var(--sk-muted);">Pricing page</div>
          </td>
          <td><strong>7,053</strong></td>
          <td>5,290</td>
          <td>2m 48s</td>
          <td><span class="sk-badge sk-badge-amber">51%</span></td>
          <td><canvas id="trend-3" width="80" height="30"></canvas></td>
        </tr>
        <tr>
          <td class="text-muted" style="font-size:.8rem;">4</td>
          <td>
            <div style="font-weight:600; font-size:.85rem;">/register</div>
            <div style="font-size:.75rem; color:var(--sk-muted);">Sign-up page</div>
          </td>
          <td><strong>5,820</strong></td>
          <td>5,820</td>
          <td>1m 57s</td>
          <td><span class="sk-badge sk-badge-red">68%</span></td>
          <td><canvas id="trend-4" width="80" height="30"></canvas></td>
        </tr>
        <tr>
          <td class="text-muted" style="font-size:.8rem;">5</td>
          <td>
            <div style="font-weight:600; font-size:.85rem;">/contact</div>
            <div style="font-size:.75rem; color:var(--sk-muted);">Contact & FAQ</div>
          </td>
          <td><strong>3,104</strong></td>
          <td>2,967</td>
          <td>2m 10s</td>
          <td><span class="sk-badge sk-badge-green">33%</span></td>
          <td><canvas id="trend-5" width="80" height="30"></canvas></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

{% endblock %}


{% block extra_js %}
<script>
/* ============================================================
   DASHBOARD CHARTS — Chart.js 4
   ============================================================ */

/* ── Shared defaults ─────────────────────────────────────── */
Chart.defaults.font.family = "'Inter', system-ui, sans-serif";
Chart.defaults.font.size   = 12;
Chart.defaults.color       = '#94a3b8';
Chart.defaults.plugins.legend.display = false;

const BLUE   = '#2563eb';
const BLUE_L = '#bfdbfe';
const BLUE_T = 'rgba(37,99,235,0.12)';
const MUTED  = '#e2e8f0';

function blueGradient(ctx, area) {
  const g = ctx.createLinearGradient(0, area.top, 0, area.bottom);
  g.addColorStop(0, 'rgba(37,99,235,0.18)');
  g.addColorStop(1, 'rgba(37,99,235,0)');
  return g;
}

/* ── Sparklines ──────────────────────────────────────────── */
function makeSparkline(id, data, color) {
  const ctx = document.getElementById(id);
  if (!ctx) return;
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: data.map((_, i) => i),
      datasets: [{
        data: data,
        borderColor: color,
        borderWidth: 2,
        pointRadius: 0,
        tension: 0.45,
        fill: true,
        backgroundColor: (context) => {
          const { ctx: c, chartArea } = context.chart;
          if (!chartArea) return 'transparent';
          const g = c.createLinearGradient(0, chartArea.top, 0, chartArea.bottom);
          g.addColorStop(0, color + '30');
          g.addColorStop(1, color + '00');
          return g;
        }
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      animation: { duration: 800, easing: 'easeOutQuart' },
      plugins: { tooltip: { enabled: false } },
      scales: { x: { display: false }, y: { display: false } }
    }
  });
}

makeSparkline('spark-revenue', [28,35,30,42,38,48,44,52,46,55,49,60], '#2563eb');
makeSparkline('spark-users',   [120,145,130,160,175,155,190,210,195,230,215,245], '#16a34a');
makeSparkline('spark-orders',  [95,88,102,91,85,98,80,92,87,78,90,83], '#d97706');
makeSparkline('spark-conv',    [3.1,3.4,3.2,3.6,3.5,3.7,3.5,3.8,3.6,3.9,3.7,3.68], '#7c3aed');


/* ── Revenue Line Chart ──────────────────────────────────── */
const revenueData = {
  '6m': {
    labels: ['Jul','Aug','Sep','Oct','Nov','Dec'],
    revenue: [28400, 31200, 29800, 36500, 41200, 48295],
    target:  [30000, 32000, 32000, 35000, 38000, 45000],
  },
  '1y': {
    labels: ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],
    revenue: [18200,19800,21400,20100,23600,26800,28400,31200,29800,36500,41200,48295],
    target:  [20000,21000,22000,22000,24000,26000,30000,32000,32000,35000,38000,45000],
  },
  'all': {
    labels: ['2022 Q1','Q2','Q3','Q4','2023 Q1','Q2','Q3','Q4','2024 Q1','Q2','Q3','Q4'],
    revenue: [9200,11400,13100,14800,16200,18900,22400,26100,28500,33200,38900,48295],
    target:  [10000,12000,13000,15000,17000,20000,23000,27000,30000,34000,40000,48000],
  }
};

let revenueChart;
function buildRevenueChart(period) {
  const d = revenueData[period];
  if (revenueChart) revenueChart.destroy();
  const ctx = document.getElementById('chart-revenue');
  revenueChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: d.labels,
      datasets: [
        {
          label: 'Revenue',
          data: d.revenue,
          borderColor: BLUE,
          borderWidth: 2.5,
          pointRadius: 4,
          pointBackgroundColor: BLUE,
          pointHoverRadius: 6,
          tension: 0.4,
          fill: true,
          backgroundColor: (context) => {
            const { ctx: c, chartArea } = context.chart;
            if (!chartArea) return BLUE_T;
            return blueGradient(c, chartArea);
          },
          order: 1
        },
        {
          label: 'Target',
          data: d.target,
          borderColor: BLUE_L,
          borderWidth: 2,
          borderDash: [6, 4],
          pointRadius: 0,
          tension: 0.4,
          fill: false,
          order: 2
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      animation: { duration: 700, easing: 'easeOutQuart' },
      interaction: { mode: 'index', intersect: false },
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: '#fff',
          borderColor: '#e2e8f0',
          borderWidth: 1,
          titleColor: '#0f172a',
          bodyColor: '#64748b',
          padding: 12,
          callbacks: {
            label: ctx => ` $${ctx.parsed.y.toLocaleString()}`
          }
        }
      },
      scales: {
        x: { grid: { display: false }, border: { display: false } },
        y: {
          grid: { color: '#f1f5f9' },
          border: { display: false },
          ticks: { callback: v => '$' + (v/1000).toFixed(0) + 'k' }
        }
      }
    }
  });
}
buildRevenueChart('6m');

function setPeriod(btn, chart, period) {
  btn.closest('.dash-period-tabs').querySelectorAll('.dash-period-tab').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  if (chart === 'revenue') buildRevenueChart(period);
}


/* ── Orders Bar Chart ────────────────────────────────────── */
new Chart(document.getElementById('chart-orders'), {
  type: 'bar',
  data: {
    labels: ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],
    datasets: [
      {
        label: 'Completed',
        data: [82,95,78,101,110,98,115,127,109,134,121,118],
        backgroundColor: BLUE,
        borderRadius: 5,
        borderSkipped: false,
      },
      {
        label: 'Cancelled',
        data: [12,9,14,8,11,15,10,13,18,11,9,16],
        backgroundColor: '#fca5a5',
        borderRadius: 5,
        borderSkipped: false,
      }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    animation: { duration: 700 },
    interaction: { mode: 'index', intersect: false },
    plugins: {
      legend: { display: false },
      tooltip: {
        backgroundColor: '#fff',
        borderColor: '#e2e8f0',
        borderWidth: 1,
        titleColor: '#0f172a',
        bodyColor: '#64748b',
        padding: 12,
      }
    },
    scales: {
      x: { grid: { display: false }, border: { display: false }, stacked: false },
      y: { grid: { color: '#f1f5f9' }, border: { display: false }, ticks: { stepSize: 25 } }
    }
  }
});


/* ── Traffic Doughnut ────────────────────────────────────── */
new Chart(document.getElementById('chart-traffic'), {
  type: 'doughnut',
  data: {
    labels: ['Organic', 'Direct', 'Referral', 'Social', 'Email'],
    datasets: [{
      data: [44, 24, 16, 10, 6],
      backgroundColor: ['#2563eb', '#60a5fa', '#93c5fd', '#a78bfa', '#34d399'],
      borderWidth: 2,
      borderColor: '#fff',
      hoverOffset: 6,
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    cutout: '72%',
    animation: { duration: 800, easing: 'easeOutQuart' },
    plugins: {
      legend: { display: false },
      tooltip: {
        backgroundColor: '#fff',
        borderColor: '#e2e8f0',
        borderWidth: 1,
        titleColor: '#0f172a',
        bodyColor: '#64748b',
        padding: 12,
        callbacks: { label: ctx => ` ${ctx.label}: ${ctx.parsed}%` }
      }
    }
  }
});


/* ── Sessions Area Chart ─────────────────────────────────── */
new Chart(document.getElementById('chart-sessions'), {
  type: 'line',
  data: {
    labels: ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'],
    datasets: [{
      label: 'Sessions',
      data: [1240, 1580, 1390, 1720, 1650, 980, 870],
      borderColor: BLUE,
      borderWidth: 2.5,
      pointRadius: 3,
      pointBackgroundColor: BLUE,
      tension: 0.45,
      fill: true,
      backgroundColor: (context) => {
        const { ctx: c, chartArea } = context.chart;
        if (!chartArea) return BLUE_T;
        return blueGradient(c, chartArea);
      }
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    animation: { duration: 700 },
    interaction: { mode: 'index', intersect: false },
    plugins: {
      legend: { display: false },
      tooltip: {
        backgroundColor: '#fff',
        borderColor: '#e2e8f0',
        borderWidth: 1,
        titleColor: '#0f172a',
        bodyColor: '#64748b',
        padding: 10,
      }
    },
    scales: {
      x: { grid: { display: false }, border: { display: false } },
      y: { display: false }
    }
  }
});


/* ── Trend sparklines in table ───────────────────────────── */
const trends = {
  'trend-1': { data: [40,55,48,62,58,70,65,75], color: '#16a34a' },
  'trend-2': { data: [60,52,65,58,70,62,68,72], color: '#2563eb' },
  'trend-3': { data: [45,50,42,55,48,58,52,60], color: '#2563eb' },
  'trend-4': { data: [80,72,78,68,74,65,70,62], color: '#e11d48' },
  'trend-5': { data: [30,38,32,42,36,45,40,48], color: '#16a34a' },
};
Object.entries(trends).forEach(([id, { data, color }]) => {
  const el = document.getElementById(id);
  if (!el) return;
  new Chart(el, {
    type: 'line',
    data: {
      labels: data.map((_,i) => i),
      datasets: [{ data, borderColor: color, borderWidth: 1.5, pointRadius: 0, tension: 0.4, fill: false }]
    },
    options: {
      responsive: false,
      animation: false,
      plugins: { tooltip: { enabled: false } },
      scales: { x: { display: false }, y: { display: false } }
    }
  });
});
</script>
{% endblock %}